// webhookListener.js
app.post('/github-webhook', (req, res) => {
  const event = req.headers['x-github-event'];
  const payload = req.body;

  logSignal('RAPP_SIGNAL', {
    repo: payload.repository.full_name,
    event,
    actor: payload.sender.login,
    title: payload.issue?.title || payload.pull_request?.title,
    timestamp: Date.now()
  });

  res.status(200).send('Signal logged');
});logSignal('RAPP_SIGNAL_DROP', {
  repo: 'RappsilberLab/xiDOUBLET_Microbiome',
  type: 'issue',
  title: 'Microbiome signal validation',
  actor: 'lab-bot',
  status: 'resolved',
  timestamp: Date.now()
});on:
  pull_request:
    types: [closed]
    branches: [main]

jobs:
  signalDrop:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Deploy DNS
        run: node scripts/deployDNS.js config/dns/dns-config.json

      - name: Route Payout
        run: node scripts/routePayout.js

      - name: Log Attribution
        run: node scripts/logSignal.js "RAPP_SIGNAL_DROP"
